<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>readme.md / Apache Celix</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom style -->
    <link href="/assets/css/style.css" rel="stylesheet">
</head>
<body class="light-grey">

<a href="https://github.com/apache/celix" class="github-ribbon">
    <img src="/assets/img/forkme_right_red_aa0000.png" alt="Fork me on GitHub">
</a>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/">
            <img src="/assets/img/celix-white.svg" height="40" class="d-inline-block align-top" alt="Celix Logo">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/download.cgi">Download</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="/docs/">Docs</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="ddCommunity" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Community
                    </a>
                    <div class="dropdown-menu" aria-labelledby="ddCommunity">
                        <a class="dropdown-item" href="/contributing/youatcelix.html">You at Celix</a>
                        <a class="dropdown-item" href="/contributing/submitting-patches.html">Submitting patches</a>
                        <a class="dropdown-item" href="/contributing/releasing.html">Releasing</a>
                        <a class="dropdown-item" href="/contributing/volunteers.html">Volunteers</a>
                        <a class="dropdown-item" href="https://whimsy.apache.org/board/minutes/Celix.html">Board Reports</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="ddSupport" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Support
                    </a>
                    <div class="dropdown-menu" aria-labelledby="ddSupport">
                        <a class="dropdown-item" href="/support/mailing-list.html">Mailing Lists</a>
                        <a class="dropdown-item" href="/support/issue-tracking.html">Issue Tracking</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="ddFoundation" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        ASF
                    </a>
                    <div class="dropdown-menu" aria-labelledby="ddFoundation">
                        <a class="dropdown-item" href="https://www.apache.org/">ASF Home</a>
                        <a class="dropdown-item" href="https://www.apache.org/foundation/how-it-works.html">How it works</a>
                        <a class="dropdown-item" href="https://www.apache.org/licenses/">License</a>
                        <a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
                        <a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
                        <a class="dropdown-item" href="https://www.apache.org/security/">Security</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>


<div class="section">
    <div class="container">
        <div class="row py-4">
            <div class="col-sm-12 card">
                <div class="card-body pt-5">
                    <a class="edit-on-gh" href="https://github.com/apache/celix/edit/develop/docs/documents/cmake_commands/readme.md" title="Edit this page on GitHub">Edit on GitHub</a>
                    <a href="/docs/" title="back to documentation">&lt;&lt; back to documentation</a>

                    <p>﻿&lt;!–
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the “License”); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://www.apache.org/licenses/LICENSE-2.0
</code></pre></div></div>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
–&gt;</p>

<h1 id="apache-celix---cmake-commands">Apache Celix - CMake Commands</h1>

<p>For Apache Celix several cmake command are added to be able to work with Apache Celix bundles and deployments.</p>

<h1 id="bundles">Bundles</h1>

<h2 id="add_celix_bundle">add_celix_bundle</h2>
<p>Add a Celix bundle to the project.  There are three variants:</p>
<ul>
  <li>With SOURCES the bundle will be created using a list of sources files as input for the bundle activator library.</li>
  <li>With ACTIVATOR the bundle will be created using the library target or absolute path to existing library as activator library.</li>
  <li>With no SOURCES or ACTIVATOR a bundle without a activator will be created.</li>
</ul>

<p>Also available under the add_bundle CMake function (deprecated).</p>

<pre><code class="language-CMake">add_celix_bundle(&lt;bundle_target_name&gt; 
    SOURCES source1 source2 ...
    [NAME bundle_name] 
    [SYMBOLIC_NAME bundle_symbolic_name]
    [DESCRIPTION bundle_description]
    [VERSION bundle_version]
    [PRIVATE_LIBRARIES private_lib1 private_lib2 ...]
    [EXPORT_LIBRARIES export_lib1 export_lib2 ...]
    [IMPORT_LIBRARIES import_lib1 import_lib2 ...]
    [HEADERS "header1: header1_value" "header2: header2_value" ...]
)
</code></pre>

<pre><code class="language-CMake">add_celix_bundle(&lt;bundle_target_name&gt; 
    ACTIVATOR &lt;activator_lib&gt;
    [NAME bundle_name] 
    [SYMBOLIC_NAME bundle_symbolic_name]
    [DESCRIPTION bundle_description]
    [VERSION bundle_version]
    [PRIVATE_LIBRARIES private_lib1 private_lib2 ...]
    [EXPORT_LIBRARIES export_lib1 export_lib2 ...]
    [IMPORT_LIBRARIES import_lib1 import_lib2 ...]
    [HEADERS "header1: header1_value" "header2: header2_value" ...]
)
</code></pre>

<pre><code class="language-CMake">add_celix_bundle(&lt;bundle_target_name&gt; 
    [NAME bundle_name] 
    [SYMBOLIC_NAME bundle_symbolic_name]
    [DESCRIPTION bundle_description]
    [VERSION bundle_version]
    [PRIVATE_LIBRARIES private_lib1 private_lib2 ...]
    [EXPORT_LIBRARIES export_lib1 export_lib2 ...]
    [IMPORT_LIBRARIES import_lib1 import_lib2 ...]
    [HEADERS "header1: header1_value" "header2: header2_value" ...]
)
</code></pre>

<ul>
  <li>If NAME is provided that will be used as Bundle-Name. Default the bundle target name is used as symbolic name.</li>
  <li>If SYMBOLIC_NAME is provided that will be used as Bundle-SymbolicName. Default the bundle target name is used as symbolic name.</li>
  <li>If DESCRIPTION is provided that will be used as Bundle-Description. Default this is empty</li>
  <li>If VERSION is provided. That will be used for the Bundle-Version. In combination with SOURCES the version will alse be use to set the activator library target property VERSION and SOVERSION.
For SOVERSION only the major part is used. Expected scheme is “<major>.<minor>.<path>". Default version is "0.0.0"</path></minor></major></li>
  <li>If PRIVATE_LIBRARIES is provided all provided lib are added to the “Private-Library” manifest statement and added in the root of the bundle. libraries can be cmake library targets or absolute paths to existing libraries.</li>
  <li>If EXPORT_LIBRARIES is provided all provided lib are added to the “Export-Library” manifest statement and added in the root of the bundle. libraries can be cmake library targets or absolute paths to existing libraries. This is not yet supported by the celix framework.</li>
  <li>If IMPORT_LIBRARIES is provided all provided lib are added to the “Import-Library” manifest statement and added in the root of the bundle. libraries can be cmake library targets or absolute paths to existing libraries.  This is not yet supported by the celix framework</li>
  <li>If HEADERS is provided the headers values are appended to the bundle manifest.</li>
</ul>

<h2 id="celix_bundle_private_libs">celix_bundle_private_libs</h2>
<p>Add libraries to a bundle target. The libraries should be cmake library targets or an absolute path to a existing library.</p>

<pre><code class="language-CMake">celix_bundle_private_libs(&lt;bundle_target&gt;
    lib1 lib2 ...
)
</code></pre>

<h2 id="celix_bundle_files">celix_bundle_files</h2>
<p>Add files to the target bundle. DESTINATION is relative to the bundle archive root. 
The rest of the command is conform file(COPY …) cmake command.
See cmake file(COPY …) command for more info.</p>

<pre><code class="language-CMake">celix_bundle_files(&lt;bundle_target&gt;
    files... DESTINATION &lt;dir&gt;
    [FILE_PERMISSIONS permissions...]
    [DIRECTORY_PERMISSIONS permissions...]
    [NO_SOURCE_PERMISSIONS] [USE_SOURCE_PERMISSIONS]
    [FILES_MATCHING]
    [[PATTERN &lt;pattern&gt; | REGEX &lt;regex&gt;]
    [EXCLUDE] [PERMISSIONS permissions...]] [...])
)
</code></pre>

<h2 id="celix_bundle_headers">celix_bundle_headers</h2>
<p>Append the provided headers to the target bundle manifest.</p>

<pre><code class="language-CMake">celix_bundle_headers(&lt;bundle_target&gt;
    "header1: header1_value"
    "header2: header2_value"
    ...
)
</code></pre>

<h2 id="celix_bundle_symbolic_name">celix_bundle_symbolic_name</h2>
<p>Set bundle symbolic name</p>

<pre><code class="language-CMake">celix_bundle_symbolic_name(&lt;bundle_target&gt; symbolic_name)
</code></pre>

<h2 id="celix_bundle_name">celix_bundle_name</h2>
<p>Set bundle name</p>

<pre><code class="language-CMake">celix_bundle_name(&lt;bundle_target&gt; name)
</code></pre>

<h2 id="celix_bundle_version">celix_bundle_version</h2>
<p>Set bundle version</p>

<pre><code class="language-CMake">celix_bundle_version(&lt;bundle_target&gt; version)
</code></pre>

<h2 id="celix_bundle_description">celix_bundle_description</h2>
<p>Set bundle description</p>

<pre><code class="language-CMake">celix_bundle_description(&lt;bundle_target&gt; description)
</code></pre>

<h2 id="install_celix_bundle">install_celix_bundle</h2>
<p>Install bundle when ‘make install’ is executed. 
Bundles are installed at <code class="highlighter-rouge">&lt;install-prefix&gt;/share/&lt;project_name&gt;/bundles</code>.
Headers are installed at <code class="highlighter-rouge">&lt;install-prefix&gt;/include/&lt;project_name&gt;/&lt;bundle_name&gt;</code>
Resources are installed at <code class="highlighter-rouge">&lt;install-prefix&gt;/shared/&lt;project_name&gt;/&lt;bundle_name&gt;</code></p>

<pre><code class="language-CMake">install_celix_bundle(&lt;bundle_target&gt;
    [PROJECT_NAME] project_name
    [BUNDLE_NAME] bundle_name
    [HEADERS header_file1 header_file2 ...]
    [RESOURCES resource1 resource2 ...]
)
</code></pre>

<ul>
  <li>If PROJECT_NAME is provided that will be used as project name for installing. Default is the cmake project name.</li>
  <li>If BUNDLE_NAME is provided that will be used as bundle for installing the headers. Default is the bundle target name.</li>
  <li>If HEADERS is provided the list of provided headers will be installed.</li>
  <li>If RESOURCES is provided the list of provided resources will be installed.</li>
</ul>

<h1 id="celix-containers">Celix Containers</h1>

<h2 id="add_celix_container">add_celix_container</h2>
<p>Add a Celix container, consisting out of a selection of bundles and a simple Celix launcher.
Celix containers can be used to run/test a selection of bundles in the celix framework.
A Celix container can be found in <code class="highlighter-rouge">&lt;cmake_build_dir&gt;/deploy[/&lt;group_name&gt;]/&lt;celix_container_name&gt;</code>. 
Use the <code class="highlighter-rouge">&lt;celix_container_name&gt;</code> executable to run the deployments.</p>

<p>Also available under the add_deploy CMake function (deprecated).</p>

<pre><code class="language-CMake">add_celix_container(&lt;celix_container_name&gt;
    [COPY] 
    [CXX]
    [GROUP group_name]
    [NAME celix_container_name]
    [LAUNCHER launcher]
    [DIR dir]
    [BUNDLES &lt;bundle1&gt; &lt;bundle2&gt; ...]
    [PROPERTIES "prop1=val1" "prop2=val2" ...]
)
</code></pre>

<p>The provided bundle targets for a celix container do not have to exists (yet).
This removes the need for correctly ordering the add_celix_bundle commands so that all bundle target are present before an add_celix_container command.
If the bundle target is never added CMake will give an error:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Error evaluating generator expression:

    $&lt;TARGET_PROPERTY:foo,BUNDLE_FILE&gt;
</code></pre></div></div>

<ul>
  <li>If the COPY option is provided the selected bundles will be copied in a bundles dir and the generated config.properties will use relative paths to the bundle locations. Default bundles will not be copied and the generated config.properties will use absolute references to the bundle locations.</li>
  <li>If CXX option is provided the celix container launcher will be build as C++ executable and as result be linked with the required C++ libraries of the used compiler</li>
  <li>If GROUP is provided the celix container will be grouped in the provided group name.</li>
  <li>If NAME is provided that name will be used for the celix container dir. Default the Celix container target name will be used.</li>
  <li>If LAUNCHER is provided that path or target will be used as launcher executable for the Celix container. If no LAUNCHER is not provided the celix executable will be used.</li>
  <li>If DIR is provided, the specified dir is used instead of <code class="highlighter-rouge">&lt;cmake_build_dir&gt;/deploy</code> as deploy dir</li>
  <li>If BUNDLES is provided the list of bundles will be added the the generated config.properties for startup. Combined with COPY the bundles will also be copied to a bundles dir.</li>
  <li>If PROPERTIES is provided the list of properties will be appended to the generated config.properties</li>
</ul>

<h2 id="celix_container_bundles_dir">celix_container_bundles_dir</h2>
<p>Deploy a selection of bundles to the provided bundle dir. This can be used to create an endpoints / proxies bundles dir for the remote service admin or drivers bundles dir for the device access.</p>

<pre><code class="language-CMake">celix_container_bundles_dir(&lt;celix_container_target_name&gt;
    DIR_NAME dir_name
    BUNDLES 
        bundle1 
        bundle2 
        ...
)
</code></pre>

<h2 id="celix_container_bundles">celix_container_bundles</h2>
<p>Deploy the selected bundles. The bundles are configured for auto starting.</p>

<pre><code class="language-CMake">celix_container_bundles(&lt;celix_container_target_name&gt;
    bundle1 
    bundle2 
    ...
)
</code></pre>

<h2 id="celix_container_properties">celix_container_properties</h2>
<p>Add the provided properties to the target Celix container config.properties.</p>

<pre><code class="language-CMake">celix_container_properties(&lt;celix_container_target_name&gt;
    "prop1=val1" 
    "prop2=val2" 
    ...
)
</code></pre>

<h2 id="celix_cotainer_embedded_properties">celix_cotainer_embedded_properties</h2>
<p>Embeds the provided properties to the target Celix launcher as embedded properties.
Note that these properties can be overridden by using config.properties.</p>

<pre><code class="language-CMake">celix_container_embedded_properties(&lt;celix_container_target_name&gt;
    "prop1=val1" 
    "prop2=val2" 
    ...
)
</code></pre>

<h1 id="celix-docker-images">Celix Docker Images</h1>
<p>It is possible the use the <code class="highlighter-rouge">add_celix_docker</code> Apache Celix CMake command to create Apache Celix docker directories,
which in turn can be used to create very small Apache Celix docker images.</p>

<h2 id="add_celix_docker">add_celix_docker</h2>
<p>Adds a docker target dir, containing a all the required executables, 
libraries and filesystem needed to run a Apache Celix framework in a docker container. 
Also includes the selected bundles.</p>

<p>The add_celix_docker target is a executable target and can be used to link libraries which are needed in the docker image.</p>

<p>The docker dir can be found in <code class="highlighter-rouge">&lt;cmake_build_dir&gt;/docker[/&lt;group_name&gt;]/&lt;docker_name&gt;</code>.</p>

<p>The provided bundle targets for a docker dir do not have to exists (yet).
This removes the need for correctly order the add_celix_bundle commands so that all bundle target are present before 
an <code class="highlighter-rouge">add_celix_docker</code> command.
If the bundle target is never added CMake will give an error:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    Error evaluating generator expression:
  
      $&lt;TARGET_PROPERTY:foo,BUNDLE_FILE&gt;
</code></pre></div></div>

<pre><code class="language-CMake">add_celix_docker(&lt;docker_target_name&gt;
    [CXX]
    [GROUP group_name]
    [NAME deploy_name]
    [FROM docker_from_image]
    [BUNDLES_DIR bundle_dir_in_docker_image]
    [WORKDIR workdir_in_docker_image]
    [IMAGE_NAME docker_image_name]
    [BUNDLES &lt;bundle1&gt; &lt;bundle2&gt; ...]
    [PROPERTIES "prop1=val1" "prop2=val2" ...]
    [INSTRUCTIONS "instr1" "instr2" ...]
)
</code></pre>

<ul>
  <li>If CXX is set the entrypoint executable will be created as a C++ main file, default it is a C main file.</li>
  <li>If GROUP is provided the docker will be grouped in the provided group name.</li>
  <li>If NAME is provided that name will be used for the docker dir. Default the deploy target name will be used.</li>
  <li>If FROM is provided the docker image will use the provide FROM as base, else <code class="highlighter-rouge">FROM scratch</code> is used and 
  a minimal filesystem will be created for the docker image</li>
  <li>If BUNDLES_DIR is provided that directory will be used as bundles location. Default <code class="highlighter-rouge">/bundles</code> will be used</li>
  <li>If WORKDIR is provided that directory will be used a workdir. Default <code class="highlighter-rouge">/root</code> will be used</li>
  <li>If IMAGE_NAME is provided that will be used as docker image name. Default the NAME will be used</li>
  <li>If BUNDLES is provided, the list of bundles will be added to the docker images and configured in the generated 
 <code class="highlighter-rouge">config.properties</code></li>
  <li>If PROPERTIES is provided, the list of properties will added to the generated <code class="highlighter-rouge">config.properties</code> file</li>
  <li>If INSTRUCTIONS id provided, the list of docker instructions will be added the the generated <code class="highlighter-rouge">Dockerfile</code></li>
</ul>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="py-3 bg-secondary">
    <div class="container">
        <p class="m-0 text-center text-white">
            Copyright &copy; 2018 The Apache Software Foundation, Licensed under
            the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.
            <br>
            Apache Celix, Celix, Apache, the Apache feather logo and the Apache Celix logo are trademarks of The Apache Software Foundation.
        </p>
    </div>
</footer>

<!-- Bootstrap core JavaScript -->
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/bootstrap.bundle.min.js"></script>


</body>
</html>
